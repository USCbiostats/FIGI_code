---
title: "FIGI NSAIDS - 10/17/2018"
bibliography: /Users/mak/Dropbox/Projects/library.bib
output: 
  #pdf_document:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 2
    theme: "cosmo"
---
	
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<style type="text/css">
	h1 { /* Header 1 */
			font-size: 24px;
		font-weight: bold;
	}
h2 { /* Header 2 */
		font-size: 18px;
	font-weight: bold;
}
h3 { /* Header 2 */
		font-size: 14px;
	font-weight: bold;
}
hr {
	border: 1px solid #000;
}
</style>


# Counts table
```{r results='asis', message = F, echo = F, warning = F}
#------ Assemble Counts Table ------#
library(tidyverse)
library(data.table)
library(ggplot2)
library(kableExtra)
load("~/git/FIGI_EpiData/FIGI_Genotype_Epi_09242018.RData")

fuu <- samplefile %>% 
	filter(drop == 0,
				 gxe == 1) %>% 
	mutate(studynamef = factor(studyname),
				 outcome = ifelse(outc == "Control", 0, 
				 					 ifelse(adenoma_adv == "Case", 2, 1)))

# N, case/control with percentages
a <- fuu %>% 
	group_by(studynamef, outc) %>% 
	summarise(N = n()) %>% 
	mutate(N_freq = paste0(N, " (", 100*round(N / sum(N), 3), "%)")) %>% 
	ungroup() %>% 
	dplyr::select(-N) %>% 
	spread(outc, N_freq) %>% 
	dplyr::select(studynamef, Control, Case)

# crc
c <- fuu %>% 
	filter(outcome == 1) %>% 
	group_by(studynamef) %>% 
	summarise(crc = n())

# adv adenoma
d <- fuu %>% 
	filter(outcome == 2) %>% 
	group_by(studynamef) %>% 
	summarise(adenoma_adv = n())

finalt <- full_join(a, c, by = "studynamef")
finalt <- full_join(finalt, d, by = "studynamef")
finalt[is.na(finalt)] <- ""

kable(finalt) %>%
	kable_styling(bootstrap_options = "striped", full_width = F, position = 'left')
```


# NSAID Plots
![](/Users/mak/git/PostHarmonization/working/figi_nsaid.png)


# Case-control + Cohort Studies
![](/Users/mak/git/PostHarmonization/working/fp1.png)

# Case-control
![](/Users/mak/git/PostHarmonization/working/fp2.png)

# Cohort
![](/Users/mak/git/PostHarmonization/working/fp3.png)

# Study Heterogeneity

## NSAID (outc ~ age_ref + sex + asp_ref)
```{r results='asis', message = F, echo = F, warning = F}
library(kableExtra)

x <- readRDS("~/Desktop/tmp.rds")

kable(x) %>%
	kable_styling(bootstrap_options = "striped", full_width = F, position = 'left')


```

## Regress study design on estimates

```
Call:
	lm(formula = estimate ~ design, data = results2, weights = w)

Weighted Residuals:
	Min        1Q    Median        3Q       Max 
-0.118023 -0.009751  0.012649  0.038518  0.219363 

Coefficients:
	Estimate Std. Error t value Pr(>|t|)    
(Intercept) -0.76715    0.03709 -20.681  < 2e-16 ***
	design1      0.64223    0.07584   8.468 1.04e-10 ***
	---
	Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05425 on 43 degrees of freedom
Multiple R-squared:  0.6251,	Adjusted R-squared:  0.6164 
F-statistic:  71.7 on 1 and 43 DF,  p-value: 1.042e-10
```


# To Do
- Study Heterogeneity
- in progress

- Post-imputation analysis (NSAID, Alcohol)
- replicate NSAID
- alcohol in progress

- GxEScanR **
	- indexed BDose
- study/platform adjustment (modify algorithm to accomodate > 20 covariates)

- Analyses - GetSNPChunk + R GLM on chr22:
	- adjust by platform only
- adjust by study + platform
- include common CRC Es to the model
- compare PC1-4 vs PC1-10


# DO THIS
John - development branch has beeen updated - now supports VCF files (GetVCFInfo or something). returns a bdinfo like list (w/ minor changes), you can pass that off to get SNPvalues 
- can you test this - find a small VCF for chromosome 22, extract it, run VCF things on it, then get the table etc. compare that with binary dosage version, make sure they're identical. they SHOULD be identical (for the sample of subjects)

