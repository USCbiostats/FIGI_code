<!-- Descriptive analysis for alcoholc_heavy -->


## Variable definition

```{r, out.width="60%"}
knitr::include_graphics(c("/home/rak/Dropbox/FIGI/Results/alcoholc_heavy/images/alcohol_variable_list.png"))
```

<br>

## Notes
We split alcoholc variable into moderate and heavy intake to account for differences in association with CRC risk:  
- alcoholc_moderate (1-28g/d)  
- *alcoholc_heavy (>28g/d)*  
<br>
[alcoholc analysis plan](https://drive.google.com/open?id=19IPCQsD6soQ4E2PnQ3MFuxO0n3gpTOW0VjxkI4ZRRQM)  

[alcoholc_heavy - final scan sample size](https://drive.google.com/open?id=1O9MVefnbk-ix9sfUxa5JsoK7uUwJU8LottrmJD-8ZPk)  


```{r desc_data, include = F}
gxe_table1 <- gxe_table1 %>% 
  mutate(outcome = droplevels.factor(outcome), 
         table1_alcoholc_heavy = factor(alcoholc_heavy, exclude = NA, levels = c("nondrinker", ">28g/d", "P-value")))
label(gxe_table1$alcoholc_heavy) <- "Heavy Alcohol Intake"
label(gxe_table1$outcome) <- "Outcome"
```


## Box Plot (All Studies)
```{r fig.height=18, fig.width=13}
gxe_ggplot <- figi_gwas %>% 
  filter(gxe == 1) %>% 
  mutate(alcoholc_heavy = fct_explicit_na(alcoholc_heavy, na_level = "NA"), 
         alcoholc_heavy = fct_relevel(alcoholc_heavy, "NA", ">28g/d", "nondrinker"))

ggplot(data=gxe_ggplot, aes(x=outc)) +
    geom_bar(aes(fill = alcoholc_heavy), position = 'fill') +
    theme_bw() +
    theme(
      panel.grid.major.x = element_blank(),
      panel.grid.minor.x = element_blank()) +
    scale_fill_manual(values = c("black", "red", "cyan")) +
    facet_wrap(vars(study_gxe), ncol = 5)
```


## Tables {.tabset}

### By outcome (Control/Case)
```{r, cache = T}

my.render.cont <- function(x) {
  with(stats.apply.rounding(stats.default(x), digits=3),
       c("", "Mean (SD)"=sprintf("%s (&plusmn; %s)", MEAN, SD)))
}

my.render.cat <- function(x) {
  c("", sapply(stats.default(x),
               function(y) with(y, sprintf("%d (%0.0f %%)", FREQ, PCT))))
}

# insert p values. hacky, requires an outcome factor with third level for p value.
# Also need to specify values by name (table1_outcome) in the 'rndr' function
rndr <- function(x, name, ...) {
  if (length(x) == 0) {
    y <- gxe_table1[[name]]
    s <- rep("", length(render.default(x=y, name=name, ...)))
    if (is.numeric(y)) {
      p <- t.test(y ~ gxe_table1$table1_outcome)$p.value
    } else {
      p <- chisq.test(table(y, droplevels(gxe_table1$table1_outcome)))$p.value
    }
    s[2] <- sub("<", "&lt;", format.pval(p, digits=3, eps=0.001))
    s
  } else {
    render.default(x=x, name=name, ...)
  }
}

rndr.strat <- function(label, n, ...) {
  ifelse(n==0, label, render.strat.default(label, n, ...))
}


covariates = c("age_ref_imp", "sex", "heightcm", "bmi", "famhx1", "educ", "smoke", "hrt_ref_pm", "diab", "calcium_totqc2", "folate_totqc2", "fiberqc2", "redmeatqc2", "procmeatqc2", "fruitqc2", "vegetableqc2")


table1(as.formula(paste0("~ ", "alcoholc_heavy", "+", paste(covariates, collapse = "+"), "| table1_outcome")),
       data=gxe_table1,
       render.continuous=my.render.cont,
       render.categorical=my.render.cat,
       render=rndr, render.strat=rndr.strat, overall = F, droplevels = F)

       
```



### By alcoholc_heavy (nondrinker vs >28g/day)
```{r, cache = T}

my.render.cont <- function(x) {
  with(stats.apply.rounding(stats.default(x), digits=3),
       c("", "Mean (SD)"=sprintf("%s (&plusmn; %s)", MEAN, SD)))
}

my.render.cat <- function(x) {
  c("", sapply(stats.default(x),
               function(y) with(y, sprintf("%d (%0.0f %%)", FREQ, PCT))))
}

# insert p values. hacky, requires an outcome factor with third level for p value.
# In this case - using exposure
rndr <- function(x, name, ...) {
  if (length(x) == 0) {
    y <- gxe_table1[[name]]
    s <- rep("", length(render.default(x=y, name=name, ...)))
    if (is.numeric(y)) {
      p <- t.test(y ~ gxe_table1$alcoholc_heavy)$p.value
    } else {
      p <- chisq.test(table(y, droplevels(gxe_table1$alcoholc_heavy)))$p.value
    }
    s[2] <- sub("<", "&lt;", format.pval(p, digits=3, eps=0.001))
    s
  } else {
    render.default(x=x, name=name, ...)
  }
}

rndr.strat <- function(label, n, ...) {
  ifelse(n==0, label, render.strat.default(label, n, ...))
}

covariates = c("age_ref_imp", "sex", "heightcm", "bmi", "famhx1", "educ", "smoke", "hrt_ref_pm", "diab", "calcium_totqc2", "folate_totqc2", "fiberqc2", "redmeatqc2", "procmeatqc2", "fruitqc2", "vegetableqc2")


table1(as.formula(paste0("~ ", "outcome", "+", paste(covariates, collapse = "+"), "| table1_alcoholc_heavy")),
       data=gxe_table1,
       render.continuous=my.render.cont,
       render.categorical=my.render.cat,
       render=rndr, render.strat=rndr.strat, overall = F, droplevels = F)
```

