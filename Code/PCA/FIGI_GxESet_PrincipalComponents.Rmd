---
title: "FIGI GxE Set Principal Components"
bibliography: /home/rak/Dropbox/library.bib
output: 
  #pdf_document:
  html_document:
    css: FIGI_GxESet_styles_rmarkdown.css
    code_folding: hide
    toc: true
    toc_float: true
    toc_depth: 2
    theme: united
---

<style type="text/css">
.main-container {
  max-width: 1800px !important;
  margin-left: auto;
  margin-right: auto;
}
</style>


```{r setup, echo=F, include=F, cache=T}
library(tidyverse)
library(data.table)
library(kableExtra)
library(plotly)
library(qqman)
library(gridExtra)
library(cowplot)
library(broom)

rm(list = ls())
load("~/git/DATA/FIGI_EpiData_rdata/FIGI_Genotype_Epi_181120.RData")

Epi <- Epi %>% 
  filter(drop == 0 & gxe == 1)

pc30k <- fread("~/Dropbox/code/FIGI_EpiData/FIGI_GxESet_KGP.eigenvec", skip = 1, 
               col.names = c("FID", "IID", paste0(rep("PC", 20), seq(1,20))))

kgp_samples <- fread("~/Dropbox/code/FIGI_EpiData/integrated_call_samples_v3.20130502.ALL.panel.fix", stringsAsFactors = F) %>% 
  dplyr::rename(IID = sample)

# df <- full_join(pc30k, kgp_samples, by = 'IID')
# df <- full_join(df, Epi[,c("vcfid", "race_self", "studyname")], by = c("IID"="vcfid")) %>% 
#   mutate(race_self = factor(race_self, labels = c("Unknown", "AI_AN", "Asian", "Black", "NH_PI", "Other", "White")),
#          Group = factor(replace(super_pop,is.na(super_pop), 'FIGI'),
#                                 levels=c("FIGI","AFR", "AMR", "EAS", "EUR", "SAS"))) %>% 
#   arrange(Group)

pool <- seq(0,1,by = 0.001) # for random sampling
set.seed(2018)

df <- full_join(pc30k, kgp_samples, by = 'IID')
df <- full_join(df, Epi[,c("vcfid", "outc", "race_self", "studyname", "study_site", "study", "platform")], by = c("IID"="vcfid")) %>% 
  mutate(race_self = factor(race_self, labels = c("Unknown", "AI_AN", "Asian", "Black", "NH_PI", "Other", "White")),
         Group = factor(replace(super_pop,is.na(super_pop), 'FIGI'),
                        levels=c("FIGI","AFR", "AMR", "EAS", "EUR", "SAS")),
         Jitter = sample(pool, nrow(.), replace = T),
         Country = factor(ifelse(study_site %in% c('Alabama', 'Boca Rat', 'CA', 'CO', 'CCF', 'Colorado', 'Detriot', 'DHMC', 'GA', 'Georgetown', 'Greensvi', 'H', 'Hartford', 'Hawaii', 'HAWAII', 'Henry Ford Health System', 'IA', 'Iowa', 'JHU CLUE,WASHCO MD USA', 'Kaiser', 'Kentucky', 'Los Angeles', 'Marshfield', 'Martin M', 'Mayo Foundation', 'Midwest', 'Minn', 'Minnesota', 'MN', 'Moffitt', 'Morton P', 'NC', 'NH', 'Northeast', 'Northwest region', 'OH', 'Pittsburgh', 'PR', 'Sarasota', 'SC', 'Seattle', 'South', 'St. Jose', 'St. Vinc', 'Tallahas', 'TX', 'UCO', 'UMN', 'UNC', 'UTR', 'USA, Midwest', 'USA, Northeast', 'USA, Southeast', 'USA, Southwest', 'USA, West', 'USC/KP', 'Utah', 'Washington', 'Watson C', 'West'), 'USA',
                          ifelse(study_site %in% c('Asturias', 'Barcelona', 'CRCBarcelona', 'Granada', 'Leon', 'Murcia', 'Navarra', 'Santiago', 'San Sebastian'), 'Spain', 
                          ifelse(study_site %in% c('Barts', 'Birmingham', 'Bristol', 'Bury', 'Cardiff', 'Cambridge', 'Croydon', 'Edinburgh', 'Glasgow', 'Hounslow', 'Leeds', 'Liverpool', 'Manchester', 'Middlesborough', 'Newcastle', 'Nottingham', 'Oxford', 'Reading', 'Sheffield', 'Stockport (pilot)', 'Stoke', 'Swansea', 'Wrexham', 'UK General Population', 'UK Health Conscious'), 'UK', 
                          ifelse(study_site %in% c('ESTHER1', 'ESTHER2', 'Heidelberg', 'Verdi', 'Potsdam'), 'Germany',
                          ifelse(study_site %in% c('Nantes', 'Northeast France', 'Northwest France', 'South coast France', 'South France'), 'France',
                          ifelse(study_site %in% c('Australia', 'Melbourne'), 'Australia', 
                          ifelse(study_site %in% c('CANADA, Eastern Canada', 'CANADA, Western Canada', 'Newfoundland', 'Ontario'), 'Canada', 
                          ifelse(study_site %in% c('CZ'), 'Czech Republic',
                          ifelse(study_site %in% c('Central Sweden', 'Umea'), 'Sweden',
                          ifelse(study_site %in% c('Bilthoven', 'Utrecht'), 'Netherlands',
                          ifelse(study_site %in% c('Florence', 'Naples', 'Ragusa', 'Turin', 'Varese'), 'Italy',
                          ifelse(study_site %in% c('Greece'), 'Greece',
                          ifelse(study %in% c('EDRN', 'HPFS', 'NCCCSI', 'NCCCSII', 'NHS', 'PHS', 'REACH', 'USC_HRT_CRC', 'SMS'), 'USA', 
                          ifelse(study %in% c('ATBC'), 'Finland', 
                          ifelse(study %in% c('MECC'), 'Israel', 
                          ifelse(study %in% c('SEARCH'), 'UK', 
                          ifelse(study %in% c('CORSA'), 'Austria', 
                          ifelse(study %in% c('DACHS', 'NGCCS'), 'Germany', NA)))))))))))))))))))) %>% 
  arrange(Group)
```

# PCA Analysis

Goal - selecting # of PCs for inclusion in GWIS  

# GxESet Eigenvalues

Description of table:  
- eivenvec: eigenvector number (1 through 20)  
- eivenval: eigenvalue for each corresponding eigenvector   
- pct: variance accounted for by each eigenvector to the total  
- csum: cumulative percentage  


```{r eigenvals, message=F, echo=T, warning=F, tidy=T, cache=T}
eigenvals <- fread("~/Dropbox/code/FIGI_EpiData/FIGI_GxESet_KGP.eigenval") %>% 
  mutate(eigenvec = seq(1,20), 
         eigenval = V1, 
         tot = sum(V1),
         pct = round(100*(V1/tot), 2),
         csum = cumsum(pct)) %>% 
  dplyr::select(eigenvec, eigenval, pct, csum)

kable(eigenvals) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = 'left')

```


# PC Plots (Pairwise) {.tabset}
```{r plots_setup, message=F, echo=F, warning=F, tidy=T, cache=T}
# all of these assume object called 'df' (just as a shortcut)
plot_pc_pairs <- function(pc, npc) {
  xpc <- paste0("PC", pc)
  ypc <- paste0("PC", npc)
  
  ggplot(data = df, aes(eval(parse(text = xpc)), eval(parse(text = ypc)), color = Group)) + 
    geom_point(alpha = 0.5) + 
    labs(x = xpc,
         y = ypc,
         title = paste0(ypc, " vs. ", xpc)) + 
    scale_colour_manual(values=c("gold", "red", "black", "purple", "green", "royalblue")) +
    theme_classic() +
    theme(legend.key.size = unit(0.15, 'inches'))
}

plot_pc_jitter <- function(pc) {
  xpc <- paste0("PC", pc)
  
  ggplot(data = df, aes(eval(parse(text = xpc)), Jitter, color = Group)) + 
    geom_point(alpha = 0.5) + 
    labs(x = xpc,
         y = "Jitter",
         title = paste0("Jitter", " vs. ", xpc)) + 
    scale_colour_manual(values=c("gold", "red", "black", "purple", "green", "royalblue")) +
    theme_classic() +
    theme(legend.key.size = unit(0.15, 'inches'))
}


plot_pc_jitter_race_self <- function(pc, race_vector, title, colours) {
  xpc <- paste0("PC", pc)
  ggplot(data = df %>% filter(race_self %in% race_vector), aes(eval(parse(text = xpc)), Jitter, color = race_self)) + 
    geom_point(alpha = 0.5) + 
    labs(x = xpc,
         y = "Jitter",
         title = title) + 
    #scale_colour_manual(values=c("gold", "red", "black", "purple", "green", "royalblue")) +
    scale_colour_manual(values=colours) + 
    theme_classic() +
    theme(legend.key.size = unit(0.15, 'inches'))
}

plot_pc_jitter_country <- function(pc, country_vector, title) {
  xpc <- paste0("PC", pc)
  ggplot(data = df %>% filter(Country %in% country_vector), aes(eval(parse(text = xpc)), Jitter, color = Country)) + 
    geom_point(alpha = 0.5) + 
    labs(x = xpc,
         y = "Jitter",
         title = title) + 
    #scale_colour_manual(values=c("gold", "red", "black", "purple", "green", "royalblue")) +
    #scale_colour_manual(values=colours) + 
    theme_classic() +
    theme(legend.key.size = unit(0.15, 'inches'))
}


plot_pc_jitter_country_noUKnoUSA <- function(pc, country_vector, title) {
  xpc <- paste0("PC", pc)
  
  pf <- df %>% 
    filter(!is.na(Country)) %>% 
    filter(!Country %in% c("UK", "USA") ) %>% 
    group_by(Country) %>% 
    summarise(avgPC = mean(eval(parse(text=xpc)))) %>% 
    arrange(avgPC) 
  
  ggplot(data = df %>% filter(Country %in% country_vector) %>% mutate(Country = factor(Country, levels = as.character(pf$Country))), aes(eval(parse(text = xpc)), Jitter, color = Country)) + 
    geom_point(alpha = 0.5) + 
    labs(x = xpc,
         y = "Jitter",
         title = title) + 
    #scale_colour_manual(values=c("gold", "red", "black", "purple", "green", "royalblue")) +
    #scale_colour_manual(values=colours) + 
    theme_classic() +
    theme(legend.key.size = unit(0.15, 'inches'))
}




plot_pc_jitter_platform <- function(pc, title) {
  xpc <- paste0("PC", pc)
  
  pf <- df %>% 
    filter(!is.na(platform)) %>% 
    group_by(platform) %>% 
    summarise(avgPC = mean(eval(parse(text=xpc)))) %>% 
    arrange(avgPC) 
  
  ggplot(data = df %>% filter(!is.na(platform)) %>% mutate(platform = factor(platform, levels = as.character(pf$platform))), aes(eval(parse(text = xpc)), Jitter, color = platform)) + 
    geom_point(alpha = 0.5) + 
    labs(x = xpc,
         y = "Jitter",
         title = title) + 
    #scale_colour_manual(values=c("gold", "red", "black", "purple", "green", "royalblue")) +
    #scale_colour_manual(values=colours) + 
    theme_classic() +
    theme(legend.key.size = unit(0.15, 'inches'))
}


plot_pc_jitter_outcome <- function(pc, title) {
  xpc <- paste0("PC", pc)
  
  ggplot(data = df %>% filter(!is.na(outc)), aes(eval(parse(text = xpc)), Jitter, color = outc)) + 
    geom_point(alpha = 0.5) + 
    labs(x = xpc,
         y = "Jitter",
         title = title) + 
    #scale_colour_manual(values=c("gold", "red", "black", "purple", "green", "royalblue")) +
    #scale_colour_manual(values=colours) + 
    theme_classic() +
    theme(legend.key.size = unit(0.15, 'inches'))
}



# 
# plot_pc_jitter_platform <- function(pc, title) {
#   xpc <- paste0("PC", pc)
#   
#   # pf <- df %>% 
#   #   filter(!is.na(platform)) %>% 
#   #   group_by(platform) %>% 
#   #   summarise(avgPC = mean(eval(parse(text=xpc)))) %>% 
#   #   arrange(avgPC) 
#   
#   ggplot(data = df %>% filter(!is.na(platform)), aes(eval(parse(text = xpc)), Jitter, color = platform)) + 
#     geom_point(alpha = 0.5) + 
#     labs(x = xpc,
#          y = "Jitter",
#          title = title) + 
#     #scale_colour_manual(values=c("gold", "red", "black", "purple", "green", "royalblue")) +
#     #scale_colour_manual(values=colours) + 
#     theme_classic() +
#     theme(legend.key.size = unit(0.15, 'inches'))
# }


plot_pc_jitter_study <- function(pc, study_vector, title) {
  xpc <- paste0("PC", pc)
  ggplot(data = df %>% filter(study %in% study_vector), aes(eval(parse(text = xpc)), Jitter, color = study)) + 
    geom_point(alpha = 0.5) + 
    labs(x = xpc,
         y = "Jitter",
         title = title) + 
    #scale_colour_manual(values=c("gold", "red", "black", "purple", "green", "royalblue")) +
    #scale_colour_manual(values=colours) + 
    theme_classic() +
    theme(legend.key.size = unit(0.15, 'inches'))
}

```

Pairwise plots between each principal component (PCs 1-10)   

## PC1
```{r pairwise_plots_pc1, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 20}
pc_list <- as.list(2:10)
x <- lapply(pc_list, plot_pc_pairs, pc=1)
plot_grid(x[[1]], x[[2]], x[[3]], x[[4]], x[[5]], x[[6]], x[[7]], x[[8]], x[[9]], cols = 2)
```

## PC2
```{r pairwise_plots_pc2, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 16}
pc_list <- as.list(3:10)
x <- lapply(pc_list, plot_pc_pairs, pc=2)
plot_grid(x[[1]], x[[2]], x[[3]], x[[4]], x[[5]], x[[6]], x[[7]], x[[8]], cols = 2)
```

## PC3
```{r pairwise_plots_pc3, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 16}
pc_list <- as.list(4:10)
x <- lapply(pc_list, plot_pc_pairs, pc=2)
plot_grid(x[[1]], x[[2]], x[[3]], x[[4]], x[[5]], x[[6]], x[[7]], cols = 2)
```

## PC4
```{r pairwise_plots_pc4, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 12}
pc_list <- as.list(5:10)
x <- lapply(pc_list, plot_pc_pairs, pc=2)
plot_grid(x[[1]], x[[2]], x[[3]], x[[4]], x[[5]], x[[6]], cols = 2)
```

## PC5
```{r pairwise_plots_pc5, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 12}
pc_list <- as.list(6:10)
x <- lapply(pc_list, plot_pc_pairs, pc=2)
plot_grid(x[[1]], x[[2]], x[[3]], x[[4]], x[[5]], cols = 2)
```

## PC6
```{r pairwise_plots_pc6, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc_list <- as.list(7:10)
x <- lapply(pc_list, plot_pc_pairs, pc=2)
plot_grid(x[[1]], x[[2]], x[[3]], x[[4]], cols = 2)
```

## PC7
```{r pairwise_plots_pc7, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc_list <- as.list(8:10)
x <- lapply(pc_list, plot_pc_pairs, pc=2)
plot_grid(x[[1]], x[[2]], x[[3]], cols = 2)
```

## PC8
```{r pairwise_plots_pc8, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc_list <- as.list(9:10)
x <- lapply(pc_list, plot_pc_pairs, pc=2)
plot_grid(x[[1]], x[[2]], cols = 2)
```

## PC9
```{r pairwise_plots_pc9, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc_list <- as.list(10:10)
x <- lapply(pc_list, plot_pc_pairs, pc=2)
plot_grid(x[[1]], cols = 2)
```


# PC Plots (single PC) {.tabset}

Principal components vs random 'jitter' variable, to visualize variation captured by each principal component (along x-axis).  

Plots include Thousand Genome samples. Legend description:  
- FIGI: FIGI GxE Set Samples (N = 102,792)  
- AFR: 1KG African  
- AMR: 1KG Admixed  
- EAS: 1KG East Asian  
- EUR: 1KG European  
- SAS: 1KG South Asian  

## PC 1-10
```{r plots_jitter_pc1-10, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 20}
pc_list <- as.list(1:10)
x <- lapply(pc_list, plot_pc_jitter)
plot_grid(x[[1]], x[[2]], x[[3]], x[[4]], x[[5]], x[[6]], x[[7]], x[[8]], x[[9]], x[[10]], cols = 2)
```

## PC 11-20
```{r plots_jitter_pc11-20, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 20}
pc_list <- as.list(11:20)
x <- lapply(pc_list, plot_pc_jitter)
plot_grid(x[[1]], x[[2]], x[[3]], x[[4]], x[[5]], x[[6]], x[[7]], x[[8]], x[[9]], x[[10]], cols = 2)
```


# PC Plots (super_pop/race)  {.tabset}

Similar plots as above, for PCs 1-10, split by FIGI self reported race ('race_self')  

## PC1
```{r plots_jitter_race_self_pc1, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 1
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_race_self(pc, "White", paste0("Jitter vs PC", pc, " - Whites"), c("green"))
p3 <- plot_pc_jitter_race_self(pc, c("Asian", "Black", "NH_PI", "AI_AN"), 
                               paste0("Jitter vs PC", pc, " - Black,Asian,AI_AN,NH_PI"), 
                               c("black", "purple", "red", "royalblue"))
p4 <- plot_pc_jitter_race_self(pc, c("Unknown", "Other"), 
                               paste0("Jitter vs PC", pc, " - Others/Unknown"), 
                               c("cyan", "darksalmon"))

plot_grid(p1, p2, p3, p4, cols = 2, align = 'v')

```

## PC2
```{r plots_jitter_race_self_pc2, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 2
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_race_self(pc, "White", paste0("Jitter vs PC", pc, " - Whites"), c("green"))
p3 <- plot_pc_jitter_race_self(pc, c("Asian", "Black", "NH_PI", "AI_AN"),
                               paste0("Jitter vs PC", pc, " - Black,Asian,AI_AN,NH_PI"),
                               c("black", "purple", "red", "royalblue"))
p4 <- plot_pc_jitter_race_self(pc, c("Unknown", "Other"),
                               paste0("Jitter vs PC", pc, " - Others/Unknown"),
                               c("cyan", "darksalmon"))

plot_grid(p1, p2, p3, p4, cols = 2, align = 'v')

```


## PC3
```{r plots_jitter_race_self_pc3, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 3
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_race_self(pc, "White", paste0("Jitter vs PC", pc, " - Whites"), c("green"))
p3 <- plot_pc_jitter_race_self(pc, c("Asian", "Black", "NH_PI", "AI_AN"),
                               paste0("Jitter vs PC", pc, " - Black,Asian,AI_AN,NH_PI"),
                               c("black", "purple", "red", "royalblue"))
p4 <- plot_pc_jitter_race_self(pc, c("Unknown", "Other"),
                               paste0("Jitter vs PC", pc, " - Others/Unknown"),
                               c("cyan", "darksalmon"))

plot_grid(p1, p2, p3, p4, cols = 2, align = 'v')

```


## PC4
```{r plots_jitter_race_self_pc4, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 4
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_race_self(pc, "White", paste0("Jitter vs PC", pc, " - Whites"), c("green"))
p3 <- plot_pc_jitter_race_self(pc, c("Asian", "Black", "NH_PI", "AI_AN"),
                               paste0("Jitter vs PC", pc, " - Black,Asian,AI_AN,NH_PI"),
                               c("black", "purple", "red", "royalblue"))
p4 <- plot_pc_jitter_race_self(pc, c("Unknown", "Other"),
                               paste0("Jitter vs PC", pc, " - Others/Unknown"),
                               c("cyan", "darksalmon"))

plot_grid(p1, p2, p3, p4, cols = 2, align = 'v')

```


## PC5
```{r plots_jitter_race_self_pc5, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 5
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_race_self(pc, "White", paste0("Jitter vs PC", pc, " - Whites"), c("green"))
p3 <- plot_pc_jitter_race_self(pc, c("Asian", "Black", "NH_PI", "AI_AN"),
                               paste0("Jitter vs PC", pc, " - Black,Asian,AI_AN,NH_PI"),
                               c("black", "purple", "red", "royalblue"))
p4 <- plot_pc_jitter_race_self(pc, c("Unknown", "Other"),
                               paste0("Jitter vs PC", pc, " - Others/Unknown"),
                               c("cyan", "darksalmon"))

plot_grid(p1, p2, p3, p4, cols = 2, align = 'v')

```


## PC6
```{r plots_jitter_race_self_pc6, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 6
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_race_self(pc, "White", paste0("Jitter vs PC", pc, " - Whites"), c("green"))
p3 <- plot_pc_jitter_race_self(pc, c("Asian", "Black", "NH_PI", "AI_AN"),
                               paste0("Jitter vs PC", pc, " - Black,Asian,AI_AN,NH_PI"),
                               c("black", "purple", "red", "royalblue"))
p4 <- plot_pc_jitter_race_self(pc, c("Unknown", "Other"),
                               paste0("Jitter vs PC", pc, " - Others/Unknown"),
                               c("cyan", "darksalmon"))

plot_grid(p1, p2, p3, p4, cols = 2, align = 'v')

```

## PC7
```{r plots_jitter_race_self_pc7, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 7
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_race_self(pc, "White", paste0("Jitter vs PC", pc, " - Whites"), c("green"))
p3 <- plot_pc_jitter_race_self(pc, c("Asian", "Black", "NH_PI", "AI_AN"),
                               paste0("Jitter vs PC", pc, " - Black,Asian,AI_AN,NH_PI"),
                               c("black", "purple", "red", "royalblue"))
p4 <- plot_pc_jitter_race_self(pc, c("Unknown", "Other"),
                               paste0("Jitter vs PC", pc, " - Others/Unknown"),
                               c("cyan", "darksalmon"))

plot_grid(p1, p2, p3, p4, cols = 2, align = 'v')

```

## PC8
```{r plots_jitter_race_self_pc8, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 8
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_race_self(pc, "White", paste0("Jitter vs PC", pc, " - Whites"), c("green"))
p3 <- plot_pc_jitter_race_self(pc, c("Asian", "Black", "NH_PI", "AI_AN"),
                               paste0("Jitter vs PC", pc, " - Black,Asian,AI_AN,NH_PI"),
                               c("black", "purple", "red", "royalblue"))
p4 <- plot_pc_jitter_race_self(pc, c("Unknown", "Other"),
                               paste0("Jitter vs PC", pc, " - Others/Unknown"),
                               c("cyan", "darksalmon"))

plot_grid(p1, p2, p3, p4, cols = 2, align = 'v')

```


## PC9
```{r plots_jitter_race_self_pc9, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 9
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_race_self(pc, "White", paste0("Jitter vs PC", pc, " - Whites"), c("green"))
p3 <- plot_pc_jitter_race_self(pc, c("Asian", "Black", "NH_PI", "AI_AN"),
                               paste0("Jitter vs PC", pc, " - Black,Asian,AI_AN,NH_PI"),
                               c("black", "purple", "red", "royalblue"))
p4 <- plot_pc_jitter_race_self(pc, c("Unknown", "Other"),
                               paste0("Jitter vs PC", pc, " - Others/Unknown"),
                               c("cyan", "darksalmon"))

plot_grid(p1, p2, p3, p4, cols = 2, align = 'v')

```

## PC10
```{r plots_jitter_race_self_pc10, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 10
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_race_self(pc, "White", paste0("Jitter vs PC", pc, " - Whites"), c("green"))
p3 <- plot_pc_jitter_race_self(pc, c("Asian", "Black", "NH_PI", "AI_AN"),
                               paste0("Jitter vs PC", pc, " - Black,Asian,AI_AN,NH_PI"),
                               c("black", "purple", "red", "royalblue"))
p4 <- plot_pc_jitter_race_self(pc, c("Unknown", "Other"),
                               paste0("Jitter vs PC", pc, " - Others/Unknown"),
                               c("cyan", "darksalmon"))

plot_grid(p1, p2, p3, p4, cols = 2, align = 'v')

```



# PC Plots (Country) {.tabset}

Similar plots as above, for PCs 1-10, split by STUDY COUNTRY (as ascertained by 'study_site' + other documentation)   

## PC1
```{r plots_jitter_country_pc1, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 1
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_country_noUKnoUSA(pc, c("Australia", "Austria", "Canada","Czech","Republic","Finland","France", "Germany","Greece","Israel","Italy","Netherlands","Spain","Sweden"), paste0("Jitter vs PC", pc, " - non UK/USA"))
p3 <- plot_pc_jitter_country(pc, c("UK", "USA"), paste0("Jitter vs PC", pc, " - UK/USA"))

plot_grid(p1, p2, NULL, p3, cols = 2, align = 'v')
```

## PC2
```{r plots_jitter_country_pc2, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 2
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_country_noUKnoUSA(pc, c("Australia", "Austria", "Canada","Czech","Republic","Finland","France", "Germany","Greece","Israel","Italy","Netherlands","Spain","Sweden"), paste0("Jitter vs PC", pc, " - non UK/USA"))
p3 <- plot_pc_jitter_country(pc, c("UK", "USA"), paste0("Jitter vs PC", pc, " - UK/USA"))

plot_grid(p1, p2, NULL, p3, cols = 2, align = 'v')
```

## PC3
```{r plots_jitter_country_pc3, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 3
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_country_noUKnoUSA(pc, c("Australia", "Austria", "Canada","Czech","Republic","Finland","France", "Germany","Greece","Israel","Italy","Netherlands","Spain","Sweden"), paste0("Jitter vs PC", pc, " - non UK/USA"))
p3 <- plot_pc_jitter_country(pc, c("UK", "USA"), paste0("Jitter vs PC", pc, " - UK/USA"))

plot_grid(p1, p2, NULL, p3, cols = 2, align = 'v')
```

## PC4
```{r plots_jitter_country_pc4, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 4
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_country_noUKnoUSA(pc, c("Australia", "Austria", "Canada","Czech","Republic","Finland","France", "Germany","Greece","Israel","Italy","Netherlands","Spain","Sweden"), paste0("Jitter vs PC", pc, " - non UK/USA"))
p3 <- plot_pc_jitter_country(pc, c("UK", "USA"), paste0("Jitter vs PC", pc, " - UK/USA"))

plot_grid(p1, p2, NULL, p3, cols = 2, align = 'v')
```

## PC5
```{r plots_jitter_country_pc5, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 5
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_country_noUKnoUSA(pc, c("Australia", "Austria", "Canada","Czech","Republic","Finland","France", "Germany","Greece","Israel","Italy","Netherlands","Spain","Sweden"), paste0("Jitter vs PC", pc, " - non UK/USA"))
p3 <- plot_pc_jitter_country(pc, c("UK", "USA"), paste0("Jitter vs PC", pc, " - UK/USA"))

plot_grid(p1, p2, NULL, p3, cols = 2, align = 'v')
```

## PC6
```{r plots_jitter_country_pc6, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 6
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_country_noUKnoUSA(pc, c("Australia", "Austria", "Canada","Czech","Republic","Finland","France", "Germany","Greece","Israel","Italy","Netherlands","Spain","Sweden"), paste0("Jitter vs PC", pc, " - non UK/USA"))
p3 <- plot_pc_jitter_country(pc, c("UK", "USA"), paste0("Jitter vs PC", pc, " - UK/USA"))

plot_grid(p1, p2, NULL, p3, cols = 2, align = 'v')
```

## PC7
```{r plots_jitter_country_pc7, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 7
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_country_noUKnoUSA(pc, c("Australia", "Austria", "Canada","Czech","Republic","Finland","France", "Germany","Greece","Israel","Italy","Netherlands","Spain","Sweden"), paste0("Jitter vs PC", pc, " - non UK/USA"))
p3 <- plot_pc_jitter_country(pc, c("UK", "USA"), paste0("Jitter vs PC", pc, " - UK/USA"))

plot_grid(p1, p2, NULL, p3, cols = 2, align = 'v')
```

## PC8
```{r plots_jitter_country_pc8, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 8
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_country_noUKnoUSA(pc, c("Australia", "Austria", "Canada","Czech","Republic","Finland","France", "Germany","Greece","Israel","Italy","Netherlands","Spain","Sweden"), paste0("Jitter vs PC", pc, " - non UK/USA"))
p3 <- plot_pc_jitter_country(pc, c("UK", "USA"), paste0("Jitter vs PC", pc, " - UK/USA"))

plot_grid(p1, p2, NULL, p3, cols = 2, align = 'v')
```

## PC9
```{r plots_jitter_country_pc9, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 9
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_country_noUKnoUSA(pc, c("Australia", "Austria", "Canada","Czech","Republic","Finland","France", "Germany","Greece","Israel","Italy","Netherlands","Spain","Sweden"), paste0("Jitter vs PC", pc, " - non UK/USA"))
p3 <- plot_pc_jitter_country(pc, c("UK", "USA"), paste0("Jitter vs PC", pc, " - UK/USA"))

plot_grid(p1, p2, NULL, p3, cols = 2, align = 'v')
```

## PC10
```{r plots_jitter_country_pc10, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 10
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_country_noUKnoUSA(pc, c("Australia", "Austria", "Canada","Czech","Republic","Finland","France", "Germany","Greece","Israel","Italy","Netherlands","Spain","Sweden"), paste0("Jitter vs PC", pc, " - non UK/USA"))
p3 <- plot_pc_jitter_country(pc, c("UK", "USA"), paste0("Jitter vs PC", pc, " - UK/USA"))

plot_grid(p1, p2, NULL, p3, cols = 2, align = 'v')
```

# PC Plots (Platform) {.tabset}

## PC1
```{r plots_jitter_platform_pc1, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 1
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_platform(pc, paste0("Jitter vs PC", pc, " - platform"))

plot_grid(p1, p2, cols = 2) 
```

## PC2
```{r plots_jitter_platform_pc2, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 2
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_platform(pc, paste0("Jitter vs PC", pc, " - platform"))

plot_grid(p1, p2, cols = 2) 
```

## PC3
```{r plots_jitter_platform_pc3, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 3
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_platform(pc, paste0("Jitter vs PC", pc, " - platform"))

plot_grid(p1, p2, cols = 2) 
```

## PC4
```{r plots_jitter_platform_pc4, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 4
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_platform(pc, paste0("Jitter vs PC", pc, " - platform"))

plot_grid(p1, p2, cols = 2) 
```

## PC5
```{r plots_jitter_platform_pc5, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 5
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_platform(pc, paste0("Jitter vs PC", pc, " - platform"))

plot_grid(p1, p2, cols = 2) 
```

## PC6
```{r plots_jitter_platform_pc6, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 6
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_platform(pc, paste0("Jitter vs PC", pc, " - platform"))

plot_grid(p1, p2, cols = 2) 
```

## PC7
```{r plots_jitter_platform_pc7, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 7
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_platform(pc, paste0("Jitter vs PC", pc, " - platform"))

plot_grid(p1, p2, cols = 2) 
```

## PC8
```{r plots_jitter_platform_pc8, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 8
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_platform(pc, paste0("Jitter vs PC", pc, " - platform"))

plot_grid(p1, p2, cols = 2) 
```

## PC9
```{r plots_jitter_platform_pc9, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 9
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_platform(pc, paste0("Jitter vs PC", pc, " - platform"))

plot_grid(p1, p2, cols = 2) 
```

## PC10
```{r plots_jitter_platform_pc10, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 10
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_platform(pc, paste0("Jitter vs PC", pc, " - platform"))

plot_grid(p1, p2, cols = 2) 
```

# PC Plots (Study) {.tabset}

## PC1
```{r plots_jitter_study_pc1, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 1
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_study(pc, c("ASTERISK","ATBC", "CCFR", "CLUEII","Colo23","ColoCare","CORSA", "CPSII", "CRCGEN", "CzechCCS", "DACHS", "DALS", "EDRN", "EPIC", "EPICOLON"), paste0("Jitter vs PC", pc, " - study"))
p3 <- plot_pc_jitter_study(pc, c("ESTHER_VERDI", "GALEON" ,      "HawaiiCCS",   
 "HPFS"   ,      "Kentucky",     "LCCS"   ,      "MCCS"   ,      "MEC"   ,       "MECC"   ,     
 "MOFFITT"   ,   "NCCCSI"   ,    "NCCCSII"  ,    "NFCCR"       , "NGCCS"     ,   "NHS"  ), paste0("Jitter vs PC", pc, " - study"))
p4 <- plot_pc_jitter_study(pc, c( "PHS"    ,      "PLCO"    ,     "PPS3"     ,    "PPS4"   ,      "REACH"    ,    "SEARCH"      ,
 "SELECT"    ,   "SMC_COSM"   ,  "SMS"   ,       "UKB"  ,        "USC_HRT_CRC"  ,"VITAL",       
"WHI"), paste0("Jitter vs PC", pc, " - study"))


plot_grid(p1, p2, p3, p4, cols = 2, align = 'v') 
```

            
## PC2
```{r plots_jitter_study_pc2, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 2
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_study(pc, c("ASTERISK","ATBC", "CCFR", "CLUEII","Colo23","ColoCare","CORSA", "CPSII", "CRCGEN", "CzechCCS", "DACHS", "DALS", "EDRN", "EPIC", "EPICOLON"), paste0("Jitter vs PC", pc, " - study"))
p3 <- plot_pc_jitter_study(pc, c("ESTHER_VERDI", "GALEON" ,      "HawaiiCCS",   
 "HPFS"   ,      "Kentucky",     "LCCS"   ,      "MCCS"   ,      "MEC"   ,       "MECC"   ,     
 "MOFFITT"   ,   "NCCCSI"   ,    "NCCCSII"  ,    "NFCCR"       , "NGCCS"     ,   "NHS"  ), paste0("Jitter vs PC", pc, " - study"))
p4 <- plot_pc_jitter_study(pc, c( "PHS"    ,      "PLCO"    ,     "PPS3"     ,    "PPS4"   ,      "REACH"    ,    "SEARCH"      ,
 "SELECT"    ,   "SMC_COSM"   ,  "SMS"   ,       "UKB"  ,        "USC_HRT_CRC"  ,"VITAL",       
"WHI"), paste0("Jitter vs PC", pc, " - study"))


plot_grid(p1, p2, p3, p4, cols = 2, align = 'v') 
```

## PC3
```{r plots_jitter_study_pc3, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 3
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_study(pc, c("ASTERISK","ATBC", "CCFR", "CLUEII","Colo23","ColoCare","CORSA", "CPSII", "CRCGEN", "CzechCCS", "DACHS", "DALS", "EDRN", "EPIC", "EPICOLON"), paste0("Jitter vs PC", pc, " - study"))
p3 <- plot_pc_jitter_study(pc, c("ESTHER_VERDI", "GALEON" ,      "HawaiiCCS",   
 "HPFS"   ,      "Kentucky",     "LCCS"   ,      "MCCS"   ,      "MEC"   ,       "MECC"   ,     
 "MOFFITT"   ,   "NCCCSI"   ,    "NCCCSII"  ,    "NFCCR"       , "NGCCS"     ,   "NHS"  ), paste0("Jitter vs PC", pc, " - study"))
p4 <- plot_pc_jitter_study(pc, c( "PHS"    ,      "PLCO"    ,     "PPS3"     ,    "PPS4"   ,      "REACH"    ,    "SEARCH"      ,
 "SELECT"    ,   "SMC_COSM"   ,  "SMS"   ,       "UKB"  ,        "USC_HRT_CRC"  ,"VITAL",       
"WHI"), paste0("Jitter vs PC", pc, " - study"))


plot_grid(p1, p2, p3, p4, cols = 2, align = 'v') 
```

## PC4
```{r plots_jitter_study_pc4, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 4
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_study(pc, c("ASTERISK","ATBC", "CCFR", "CLUEII","Colo23","ColoCare","CORSA", "CPSII", "CRCGEN", "CzechCCS", "DACHS", "DALS", "EDRN", "EPIC", "EPICOLON"), paste0("Jitter vs PC", pc, " - study"))
p3 <- plot_pc_jitter_study(pc, c("ESTHER_VERDI", "GALEON" ,      "HawaiiCCS",   
 "HPFS"   ,      "Kentucky",     "LCCS"   ,      "MCCS"   ,      "MEC"   ,       "MECC"   ,     
 "MOFFITT"   ,   "NCCCSI"   ,    "NCCCSII"  ,    "NFCCR"       , "NGCCS"     ,   "NHS"  ), paste0("Jitter vs PC", pc, " - study"))
p4 <- plot_pc_jitter_study(pc, c( "PHS"    ,      "PLCO"    ,     "PPS3"     ,    "PPS4"   ,      "REACH"    ,    "SEARCH"      ,
 "SELECT"    ,   "SMC_COSM"   ,  "SMS"   ,       "UKB"  ,        "USC_HRT_CRC"  ,"VITAL",       
"WHI"), paste0("Jitter vs PC", pc, " - study"))


plot_grid(p1, p2, p3, p4, cols = 2, align = 'v') 
```

## PC5
```{r plots_jitter_study_pc5, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 5
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_study(pc, c("ASTERISK","ATBC", "CCFR", "CLUEII","Colo23","ColoCare","CORSA", "CPSII", "CRCGEN", "CzechCCS", "DACHS", "DALS", "EDRN", "EPIC", "EPICOLON"), paste0("Jitter vs PC", pc, " - study"))
p3 <- plot_pc_jitter_study(pc, c("ESTHER_VERDI", "GALEON" ,      "HawaiiCCS",   
 "HPFS"   ,      "Kentucky",     "LCCS"   ,      "MCCS"   ,      "MEC"   ,       "MECC"   ,     
 "MOFFITT"   ,   "NCCCSI"   ,    "NCCCSII"  ,    "NFCCR"       , "NGCCS"     ,   "NHS"  ), paste0("Jitter vs PC", pc, " - study"))
p4 <- plot_pc_jitter_study(pc, c( "PHS"    ,      "PLCO"    ,     "PPS3"     ,    "PPS4"   ,      "REACH"    ,    "SEARCH"      ,
 "SELECT"    ,   "SMC_COSM"   ,  "SMS"   ,       "UKB"  ,        "USC_HRT_CRC"  ,"VITAL",       
"WHI"), paste0("Jitter vs PC", pc, " - study"))


plot_grid(p1, p2, p3, p4, cols = 2, align = 'v') 
```

## PC6
```{r plots_jitter_study_pc6, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 6
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_study(pc, c("ASTERISK","ATBC", "CCFR", "CLUEII","Colo23","ColoCare","CORSA", "CPSII", "CRCGEN", "CzechCCS", "DACHS", "DALS", "EDRN", "EPIC", "EPICOLON"), paste0("Jitter vs PC", pc, " - study"))
p3 <- plot_pc_jitter_study(pc, c("ESTHER_VERDI", "GALEON" ,      "HawaiiCCS",   
 "HPFS"   ,      "Kentucky",     "LCCS"   ,      "MCCS"   ,      "MEC"   ,       "MECC"   ,     
 "MOFFITT"   ,   "NCCCSI"   ,    "NCCCSII"  ,    "NFCCR"       , "NGCCS"     ,   "NHS"  ), paste0("Jitter vs PC", pc, " - study"))
p4 <- plot_pc_jitter_study(pc, c( "PHS"    ,      "PLCO"    ,     "PPS3"     ,    "PPS4"   ,      "REACH"    ,    "SEARCH"      ,
 "SELECT"    ,   "SMC_COSM"   ,  "SMS"   ,       "UKB"  ,        "USC_HRT_CRC"  ,"VITAL",       
"WHI"), paste0("Jitter vs PC", pc, " - study"))


plot_grid(p1, p2, p3, p4, cols = 2, align = 'v') 
```

## PC7
```{r plots_jitter_study_pc7, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 7
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_study(pc, c("ASTERISK","ATBC", "CCFR", "CLUEII","Colo23","ColoCare","CORSA", "CPSII", "CRCGEN", "CzechCCS", "DACHS", "DALS", "EDRN", "EPIC", "EPICOLON"), paste0("Jitter vs PC", pc, " - study"))
p3 <- plot_pc_jitter_study(pc, c("ESTHER_VERDI", "GALEON" ,      "HawaiiCCS",   
 "HPFS"   ,      "Kentucky",     "LCCS"   ,      "MCCS"   ,      "MEC"   ,       "MECC"   ,     
 "MOFFITT"   ,   "NCCCSI"   ,    "NCCCSII"  ,    "NFCCR"       , "NGCCS"     ,   "NHS"  ), paste0("Jitter vs PC", pc, " - study"))
p4 <- plot_pc_jitter_study(pc, c( "PHS"    ,      "PLCO"    ,     "PPS3"     ,    "PPS4"   ,      "REACH"    ,    "SEARCH"      ,
 "SELECT"    ,   "SMC_COSM"   ,  "SMS"   ,       "UKB"  ,        "USC_HRT_CRC"  ,"VITAL",       
"WHI"), paste0("Jitter vs PC", pc, " - study"))


plot_grid(p1, p2, p3, p4, cols = 2, align = 'v') 
```

## PC8
```{r plots_jitter_study_pc8, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 8
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_study(pc, c("ASTERISK","ATBC", "CCFR", "CLUEII","Colo23","ColoCare","CORSA", "CPSII", "CRCGEN", "CzechCCS", "DACHS", "DALS", "EDRN", "EPIC", "EPICOLON"), paste0("Jitter vs PC", pc, " - study"))
p3 <- plot_pc_jitter_study(pc, c("ESTHER_VERDI", "GALEON" ,      "HawaiiCCS",   
 "HPFS"   ,      "Kentucky",     "LCCS"   ,      "MCCS"   ,      "MEC"   ,       "MECC"   ,     
 "MOFFITT"   ,   "NCCCSI"   ,    "NCCCSII"  ,    "NFCCR"       , "NGCCS"     ,   "NHS"  ), paste0("Jitter vs PC", pc, " - study"))
p4 <- plot_pc_jitter_study(pc, c( "PHS"    ,      "PLCO"    ,     "PPS3"     ,    "PPS4"   ,      "REACH"    ,    "SEARCH"      ,
 "SELECT"    ,   "SMC_COSM"   ,  "SMS"   ,       "UKB"  ,        "USC_HRT_CRC"  ,"VITAL",       
"WHI"), paste0("Jitter vs PC", pc, " - study"))


plot_grid(p1, p2, p3, p4, cols = 2, align = 'v') 
```

## PC9
```{r plots_jitter_study_pc9, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 9
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_study(pc, c("ASTERISK","ATBC", "CCFR", "CLUEII","Colo23","ColoCare","CORSA", "CPSII", "CRCGEN", "CzechCCS", "DACHS", "DALS", "EDRN", "EPIC", "EPICOLON"), paste0("Jitter vs PC", pc, " - study"))
p3 <- plot_pc_jitter_study(pc, c("ESTHER_VERDI", "GALEON" ,      "HawaiiCCS",   
 "HPFS"   ,      "Kentucky",     "LCCS"   ,      "MCCS"   ,      "MEC"   ,       "MECC"   ,     
 "MOFFITT"   ,   "NCCCSI"   ,    "NCCCSII"  ,    "NFCCR"       , "NGCCS"     ,   "NHS"  ), paste0("Jitter vs PC", pc, " - study"))
p4 <- plot_pc_jitter_study(pc, c( "PHS"    ,      "PLCO"    ,     "PPS3"     ,    "PPS4"   ,      "REACH"    ,    "SEARCH"      ,
 "SELECT"    ,   "SMC_COSM"   ,  "SMS"   ,       "UKB"  ,        "USC_HRT_CRC"  ,"VITAL",       
"WHI"), paste0("Jitter vs PC", pc, " - study"))


plot_grid(p1, p2, p3, p4, cols = 2, align = 'v') 
```

## PC10
```{r plots_jitter_study_pc10, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 8}
pc = 10
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_study(pc, c("ASTERISK","ATBC", "CCFR", "CLUEII","Colo23","ColoCare","CORSA", "CPSII", "CRCGEN", "CzechCCS", "DACHS", "DALS", "EDRN", "EPIC", "EPICOLON"), paste0("Jitter vs PC", pc, " - study"))
p3 <- plot_pc_jitter_study(pc, c("ESTHER_VERDI", "GALEON" ,      "HawaiiCCS",   
 "HPFS"   ,      "Kentucky",     "LCCS"   ,      "MCCS"   ,      "MEC"   ,       "MECC"   ,     
 "MOFFITT"   ,   "NCCCSI"   ,    "NCCCSII"  ,    "NFCCR"       , "NGCCS"     ,   "NHS"  ), paste0("Jitter vs PC", pc, " - study"))
p4 <- plot_pc_jitter_study(pc, c( "PHS"    ,      "PLCO"    ,     "PPS3"     ,    "PPS4"   ,      "REACH"    ,    "SEARCH"      ,
 "SELECT"    ,   "SMC_COSM"   ,  "SMS"   ,       "UKB"  ,        "USC_HRT_CRC"  ,"VITAL",       
"WHI"), paste0("Jitter vs PC", pc, " - study"))


plot_grid(p1, p2, p3, p4, cols = 2, align = 'v') 
```  
<br>

------  

# PC Plots (Outcome) {.tabset}

## PC1
```{r plots_jitter_outcome_pc1, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 1
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_outcome(pc, paste0("Jitter vs PC", pc, " - Outcome"))
plot_grid(p1, p2, cols = 2)  
```

## PC2
```{r plots_jitter_outcome_pc2, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 2
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_outcome(pc, paste0("Jitter vs PC", pc, " - Outcome"))
plot_grid(p1, p2, cols = 2)  
```

## PC3
```{r plots_jitter_outcome_pc3, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 3
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_outcome(pc, paste0("Jitter vs PC", pc, " - Outcome"))
plot_grid(p1, p2, cols = 2)  
```

## PC4
```{r plots_jitter_outcome_pc4, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 4
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_outcome(pc, paste0("Jitter vs PC", pc, " - Outcome"))
plot_grid(p1, p2, cols = 2)  
```

## PC5
```{r plots_jitter_outcome_pc5, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 5
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_outcome(pc, paste0("Jitter vs PC", pc, " - Outcome"))
plot_grid(p1, p2, cols = 2)  
```

## PC6
```{r plots_jitter_outcome_pc6, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 6
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_outcome(pc, paste0("Jitter vs PC", pc, " - Outcome"))
plot_grid(p1, p2, cols = 2)  
```

## PC7
```{r plots_jitter_outcome_pc7, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 7
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_outcome(pc, paste0("Jitter vs PC", pc, " - Outcome"))
plot_grid(p1, p2, cols = 2)  
```

## PC8
```{r plots_jitter_outcome_pc8, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 8
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_outcome(pc, paste0("Jitter vs PC", pc, " - Outcome"))
plot_grid(p1, p2, cols = 2)  
```

## PC9
```{r plots_jitter_outcome_pc9, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 9
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_outcome(pc, paste0("Jitter vs PC", pc, " - Outcome"))
plot_grid(p1, p2, cols = 2)  
```

## PC10
```{r plots_jitter_outcome_pc10, message=F, echo=T, warning=F, tidy=T, cache=T, fig.width = 12, fig.height = 4}
pc = 10
p1 <- plot_pc_jitter(pc)
p2 <- plot_pc_jitter_outcome(pc, paste0("Jitter vs PC", pc, " - Outcome"))
plot_grid(p1, p2, cols = 2)  
```


# GLM comparison on known hits (95 SNPs)
```{r gwas95, message=F, echo=T, warning=F, tidy=F, cache=T, dependson='setup', fig.width = 12, fig.height = 12}

zero <- readRDS("~/Dropbox/code/FIGI_GxEScanR_Simple/working/ExplorePCs_agerefimp_sex.rds") %>% 
	separate(SNP, into = c("CHR", "BP"), remove = F) %>% 
	mutate(CHR = as.numeric(CHR),
				 BP = as.numeric(BP), 
				 P = p.value) %>% 
	filter(term == "y") %>% 
	arrange(p.value) %>% 
	mutate(rank_noStudyname_noPC = seq(1, nrow(.)))


a <- readRDS("~/Dropbox/code/FIGI_GxEScanR_Simple/working/ExplorePCs_agerefimp_sex_studyname.rds") %>% 
	separate(SNP, into = c("CHR", "BP"), remove = F) %>% 
	mutate(CHR = as.numeric(CHR),
				 BP = as.numeric(BP), 
				 P = p.value) %>% 
	filter(term == "y") %>% 
	arrange(p.value) %>% 
	mutate(rank_noPC = seq(1, nrow(.)))


b <- readRDS("~/Dropbox/code/FIGI_GxEScanR_Simple/working/ExplorePCs_agerefimp_sex_studyname_PC1-4.rds") %>% 
	separate(SNP, into = c("CHR", "BP"), remove = F) %>% 
	mutate(CHR = as.numeric(CHR),
				 BP = as.numeric(BP), 
				 P = p.value) %>% 
	filter(term == "y") %>% 
	arrange(p.value) %>% 
	mutate(rank_PC1_4 = seq(1, nrow(.)))


c <- readRDS("~/Dropbox/code/FIGI_GxEScanR_Simple/working/ExplorePCs_agerefimp_sex_studyname_PC1-10.rds") %>% 
	separate(SNP, into = c("CHR", "BP"), remove = F) %>% 
	mutate(CHR = as.numeric(CHR),
				 BP = as.numeric(BP), 
				 P = p.value) %>% 
	filter(term == "y") %>% 
	arrange(p.value) %>% 
	mutate(rank_PC1_10 = seq(1, nrow(.)))

d <- readRDS("~/Dropbox/code/FIGI_GxEScanR_Simple/working/ExplorePCs_agerefimp_sex_studyname_PC1-20.rds") %>% 
	separate(SNP, into = c("CHR", "BP"), remove = F) %>% 
	mutate(CHR = as.numeric(CHR),
				 BP = as.numeric(BP), 
				 P = p.value) %>% 
	filter(term == "y") %>% 
	arrange(p.value) %>% 
	mutate(rank_PC1_20 = seq(1, nrow(.)))
	

par(mfrow=c(3,2))
manhattan(zero, main = "Marginal Results (D|G)\nN = 88K, Known GWAS Hits (95)\noutc~snpdosage+age_ref_imp+sex")
manhattan(a, main = "Marginal Results (D|G)\nN = 88K, Known GWAS Hits (95)\noutc~snpdosage+age_ref_imp+sex+studyname")
manhattan(b, main = "Marginal Results (D|G)\nN = 88K, Known GWAS Hits (95)\noutc~snpdosage+age_ref_imp+sex+studyname+PC1-4")
manhattan(c, main = "Marginal Results (D|G)\nN = 88K, Known GWAS Hits (95)\noutc~snpdosage+age_ref_imp+sex+studyname+PC1-10")
manhattan(c, main = "Marginal Results (D|G)\nN = 88K, Known GWAS Hits (95)\noutc~snpdosage+age_ref_imp+sex+studyname+PC1-20")

```


# GLM Ranks by model
```{r gwas95_ranks, message=F, echo=T, warning=F, tidy=F, cache=T, dependson='setup', fig.width = 12, fig.height = 12}
tmp <- dplyr::select(zero, 
										 SNP, CHR, BP)

x <- inner_join(tmp, zero[, c('SNP', 'rank_noStudyname_noPC')])
x <- inner_join(x, a[, c('SNP', 'rank_noPC')])
x <- inner_join(x, b[, c('SNP', 'rank_PC1_4')])
x <- inner_join(x, c[, c('SNP', 'rank_PC1_10')])
x <- inner_join(x, d[, c('SNP', 'rank_PC1_20')])

kable(x) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = 'left')

```


# outcome | PC
```{r glm_outcome_pcs, message=F, echo=T, warning=F, tidy=F, cache=T, dependson='setup'}
tmp <- mutate(df, 
              outcome = ifelse(outc == "Case", 1, ifelse(outc == "Control", 0, NA)))

glm_func <- function(y) glm(outcome ~ y, data = tmp, family=binomial)
results_a <- map_dfr(tmp[,3:22], function(x) glm_func(x) %>% tidy(), .id = "PC") %>% 
  filter(term == "y") %>% 
  mutate(term = ifelse(term == "y", "PC", NA))

kable(results_a) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = 'left')
```



